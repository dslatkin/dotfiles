{{ if or .env.mac .env.debian -}}
#!/bin/bash
set -euo pipefail

if ! command -v age > /dev/null
then
    echo "ðŸ’¬ Installing age"
    brew install age
else
    echo "ðŸ’¬ Age is already installed"
fi

if [ ! -f ~/.dotfiles/identity.key ]; then
    echo "ðŸ’¬ Installing age private key"
    mkdir -p ~/.dotfiles/
    age --decrypt \
        --output ~/.dotfiles/identity.key \
        "{{ .chezmoi.sourceDir }}/dot_dotfiles/identity.key.age"
    chmod 600 ~/.dotfiles/identity.key
else
    echo "ðŸ’¬ Age private key is already installed"
fi
{{ end -}}
