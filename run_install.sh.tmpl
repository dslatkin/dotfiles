#!/bin/bash

info() {
  echo "ðŸš€ Dotfiles: $*"
}

info Installing dotfiles "$0"
{{ if eq .chezmoi.os "darwin" }}
# Mac
sw_vers
{{ else if eq .chezmoi.os "linux" }}
# Linux
uname -r
{{   if eq .chezmoi.osRelease.id "debian" }}
# Debian
lsb_release -a
{{   end }}
{{ end }}

info Installing fish
{{ if eq .chezmoi.os "darwin" }}
# macOS
info TODO
{{ else if eq .chezmoi.os "linux" }}
{{   if eq .chezmoi.osRelease.id "debian" }}
# Debian
echo 'deb http://download.opensuse.org/repositories/shells:/fish:/release:/3/Debian_9.0/ /' | sudo tee /etc/apt/sources.list.d/shells:fish:release:3.list
curl -fsSL https://download.opensuse.org/repositories/shells:fish:release:3/Debian_9.0/Release.key | gpg --dearmor | sudo tee /etc/apt/trusted.gpg.d/shells_fish_release_3.gpg > /dev/null
sudo apt-get update
sudo apt-get install fish -y
echo $(fish -v)
info Changing shell for "$USER"
cat /etc/passwd
sudo chsh -s /usr/bin/fish "$USER"
info Shell changed
cat /etc/passwd
{{   end }}
{{ end }}

info Installing starship
sh -c "$(curl -fsSL https://starship.rs/install.sh)" -- --yes --verbose
starship init bash >> ~/.bashrc
starship init fish >> ~/.config/fish/config.fish

# todo brew
# info Installing brew
# NONINTERACTIVE=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Linux post-install steps
# - Run these two commands in your terminal to add Homebrew to your PATH:
#     echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> /home/vscode/.profile
#     eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
# - Install Homebrew's dependencies if you have sudo access:
#     sudo apt-get install build-essential
#   For more information, see:
#     https://docs.brew.sh/Homebrew-on-Linux

# Mac post-install steps
# echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> /Users/dslatkin/.profile
# eval "$(/opt/homebrew/bin/brew shellenv)"


info Finished install
